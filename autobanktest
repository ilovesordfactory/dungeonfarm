-- auto dungeon 
plr = game.Players.LocalPlayer
char = plr.Character
function DropBadSwords()
    for _,sword in pairs(game.Players.LocalPlayer.Backpack:GetChildren()) do
        if sword:FindFirstChild("Config").Rarity.Value < 172 and sword:FindFirstChild("Config").Nickname.Value ~= "Whitelist" then
            game.Players.LocalPlayer.Character.Humanoid:EquipTool(sword)
            game:GetService("ReplicatedStorage").Framework.RemoteEvent:FireServer(0,"BackpackServer","Drop",{})
        end
    end
end
function autoBank()
    swordTable = {}
    for i,v in pairs(game.Players.LocalPlayer.Backpack:GetChildren()) do
        if v:FindFirstChild("Config").Rarity.Value >= 172 and v.Name ~= "Whitelist" then
            autoBankStart = true
            table.insert(swordTable,v)
        end
    end
    counter = 0
    if #swordTable > 0 then
        game:GetService("ReplicatedStorage").Events.ToBasePart:FireServer("Bank")
        wait(1)
        game:GetService("TweenService"):Create(game.Players.LocalPlayer.Character.HumanoidRootPart,TweenInfo.new(1), {CFrame = game.Players.LocalPlayer.Character.HumanoidRootPart.CFrame*CFrame.new(-30,0,0)}):Play()
        wait(2)
        repeat wait()
            counter = counter+1
            game.Players.LocalPlayer.Character.Humanoid:EquipTool(swordTable[counter])
            wait(0.1)
            game:GetService("ReplicatedStorage").Framework.RemoteEvent:FireServer(0,"BackpackServer","Drop",{})
        until counter == #swordTable
    end
    print('no swords to bank')
end
function equipWhitelist()
    for i,v in pairs(plr.Backpack:GetChildren()) do
        if v:FindFirstChild("Config") then
            if v:FindFirstChild("Config"):FindFirstChild("Nickname") then
                if v:FindFirstChild("Config"):FindFirstChild("Nickname").Value == "Whitelist" then
                    char.Humanoid:EquipTool(v)
                end
            end
        end
    end
end
function collectChests()
    chests = {}
    counter = 0
    for _,chest in pairs(game.Workspace:WaitForChild("MagmaDungeon"):GetDescendants()) do
        if chest.Name == "WoodSilver" or chest.Name == "WoodGold" or chest.Name == "MagmaChest" or chest.Name == "ExtraMagmaChest" or chest.Name == "VoidChest" then
            table.insert(chests,chest)
        end
    end
    amountofChests = #chests
    DropBadSwords()
    wait(1)
    char.Humanoid:UnequipTools()
    wait(1)
    equipWhitelist()
    repeat
        oldGems = game.ReplicatedStorage.Data[plr.Name].Stats.Gems.Value
        counter = counter+1
        char.HumanoidRootPart.CFrame = chests[counter]:GetModelCFrame()
        timer2 = 0
        repeat wait(0.5) 
            timer2 = timer2+0.5
            equipWhitelist()
        until oldGems < game.ReplicatedStorage.Data[plr.Name].Stats.Gems.Value or timer2 == 1.5
    until counter == amountofChests
    DropBadSwords()
    wait(0.5)
    for _,podiumsword in pairs(game.Workspace:WaitForChild("MagmaDungeon").EndModule.Parts.Stands:GetDescendants()) do
        if podiumsword:IsA("TextLabel") then
            if podiumsword.Text == game.Players.LocalPlayer.Name then
                game:GetService("TweenService"):Create(char.HumanoidRootPart,TweenInfo.new(0.5),{CFrame = podiumsword.Parent.Parent.Parent.Pad.CFrame}):Play()
                wait(1)
                game:GetService("TweenService"):Create(char.HumanoidRootPart,TweenInfo.new(0.5),{CFrame = podiumsword.Parent.Parent.Parent.Pad.CFrame}):Play()
            end
        end
    end
    wait(0.1)
    char.Humanoid:UnequipTools()
    wait(0.3)
    DropBadSwords()
    wait(0.5)
    game.ReplicatedStorage.Framework.RemoteEvent:FireServer(0,"UIServer","Teleport",{})
    repeat wait() until game.Workspace:FindFirstChild("MagmaDungeon") == nil
end
function enterDungeon()
    if game.Workspace.Maps:FindFirstChild("Magma Hills") == nil then
        repeat wait(1.5)
            game.ReplicatedStorage.Events.ToMap:FireServer(game.ReplicatedStorage.Data:FindFirstChild(game.Players.LocalPlayer.Name).Stats,game.workspace:FindFirstChild(tostring(game.Players.LocalPlayer.Name.."'s Base")),game.Players.LocalPlayer.Name,"Magma Hills")
        until game.Workspace.Maps:FindFirstChild("Magma Hills") ~= nil
    else
        if game.Workspace:FindFirstChild("MagmaDungeon") == nil then
            repeat wait(0.5)
                game:GetService("TweenService"):Create(char.HumanoidRootPart,TweenInfo.new(1),{CFrame = game.Workspace.Maps["Magma Hills"].DungeonMatchmaking.MatchmakingPad.CFrame*CFrame.new(0,2,0)}):Play()
            until game.Workspace:FindFirstChild("MagmaDungeon") ~= nil or farming == false
        end
    end
end
function Farm()
    game:GetService("ReplicatedStorage").Framework.RemoteFunction:InvokeServer(0,"SoulTankService","AddSouls",{})
    if game.Workspace:FindFirstChild("MagmaDungeon") then
        while true do wait()
                mobTable = {}
                for i,v in pairs(game.Workspace.Mobs:GetChildren()) do
                    if v.Name == "Borock" or v.Name == "Iron Slayer" or v.Name == "The Abomination" then
                        table.insert(mobTable,v)
                    end
                end
            
            for i,v in pairs(mobTable) do
                repeat task.wait()
                        if char.Humanoid.Health/char.Humanoid.MaxHealth*100 >35 then
                            char.HumanoidRootPart.CFrame = v:GetModelCFrame()*CFrame.new(0,1,2)
                        end
                        if v:FindFirstChild("Humanoid") == nil or v:FindFirstChild("Humanoid").Health == 0 then
                            v:Destroy()
                        end 
                        if char:FindFirstChildWhichIsA("Tool") then
                            char:FindFirstChildWhichIsA("Tool"):Activate()
                            if char:FindFirstChildWhichIsA("Tool"):FindFirstChild("Config").Nickname.Value ~= "Whitelist" then
                                equipWhitelist()
                            end
                        else
                            equipWhitelist()
                        end
                until v == nil or v:FindFirstChild("Humanoid") == nil or v:FindFirstChild("Humanoid").Health == 0
            end
            if #mobTable == 0 then
                print('breaking')
                break
            end
        end
    end
end
function teleportToBoss()
    if game.Workspace:FindFirstChild("MagmaDungeon") ~= nil then
        print('tping to boss')
        char.HumanoidRootPart.CFrame = game.workspace.MagmaDungeon.EndModule.Parts.FinalBossSpawn.CFrame
    end
end
function RandomVariable(length)
	local res = ""
	for i = 1, length do
		res = res .. string.char(math.random(1, 122))
	end
	return res
end

randomstring = RandomVariable(100)

for i,v in pairs(plr.PlayerGui:GetChildren()) do
    if string.len(v.Name) == 100 then
        v:Destroy()
    end
end
local gui = Instance.new("ScreenGui",game.Players.LocalPlayer.PlayerGui)
local mainframe = Instance.new("Frame",gui)
local textbutton = Instance.new("TextButton",mainframe)
local textlabel = Instance.new("TextLabel",mainframe)


farming = false
gui.Name = tostring(randomstring)
mainframe.Position = UDim2.new(0.1,0,0.1,0)
mainframe.Visible = true
mainframe.Size = UDim2.new(0.2,0,0.1,0)
textlabel.Size = UDim2.new(1,0,-0.5,0)
textbutton.Size = UDim2.new(1,0,1,0)
textbutton.Text = "Farming: ❌"
textbutton.BackgroundColor3 = Color3.new(0,0,0)
textbutton.TextScaled = true
textbutton.Font = "GothamBold"
textlabel.Text = "Don't Disable and Re-Enable During Dungeon\nPress Q to Hide/Show GUI"
textlabel.TextScaled = true
textlabel.BackgroundColor3 = Color3.new(0,0,0)
textlabel.Font = "GothamBold"
textlabel.TextColor3 = Color3.new(255,255,255)
textbutton.TextColor3 = Color3.new(255,0,0)
textbutton.BorderSizePixel = 3.5 
textlabel.BorderSizePixel = 3.5
textlabel.BorderColor3 = Color3.new(255,0,0)
textbutton.BorderColor3 = Color3.new(255,0,0)

-- We must get the UserInputService before we can use it
local UserInputService = game:GetService("UserInputService")
 
-- A sample function providing one usage of InputBegan
UserInputService.InputBegan:Connect(function(inputKey)
    if inputKey.KeyCode == Enum.KeyCode.Q then
        if mainframe.Visible == false then
            mainframe.Visible = true
        else
            mainframe.Visible = false
        end
    end
end)
textbutton.MouseButton1Up:Connect(function()
    if farming then
        textbutton.Text = "Farming: ❌"
        textbutton.TextColor3 = Color3.new(255,0,0)
        textlabel.BorderColor3 = Color3.new(255,0,0)
        textbutton.BorderColor3 = Color3.new(255,0,0)
        farming = false
    else
        textbutton.Text = "Farming: ✅"
        textbutton.TextColor3 = Color3.new(0,255,0)
        textlabel.BorderColor3 = Color3.new(0,255,0)
        textbutton.BorderColor3 = Color3.new(0,255,0)
        farming = true
        foundSword = false
        while farming do wait()
            if game.Players.LocalPlayer.PlayerGui.MainGui:FindFirstChild("DungeonSummary") then
                game.Players.LocalPlayer.PlayerGui.MainGui.DungeonSummary:Destroy()
            end
            enterDungeon()
            wait(2)
            if farming == false then
                break
            end
            Farm()
            wait(20)
            teleportToBoss()
            wait(1)
            Farm()
            wait(1)
            collectChests()
            wait(1)
            autoBank()
            wait(1)
        end
    end
end)
